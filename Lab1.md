# *Лабораторная работа №1*
## *Установка PostgreSQL*
Поскольку PostgreSQL устанавливается из стандартных репозиториев Ubuntu, для запуска установки подключаюсь к своему серверу под учётной записью, входящей в группу sudo, и набираю в командной строке:
```
$ sudo apt update
$ sudo apt install postgresql
```
При установке пакета инсталлятор создаст новый PostgreSQL-кластер. Данный кластер представляет из себя коллекцию баз данных, которая управляется одним сервером. Также, установщик создаст рабочие директории для PostgreSQL. Данные, необходимые для работы PostgreSQL, будут находится в каталоге /var/lib/postgresql/16/main, а файлы конфигурации – в каталоге /etc/postgresql/12/main.

После завершения установки я могу убедиться, что служба PostgreSQL активна. Для чего в командной строке набираю:
```
$ sudo systemctl is-active postgresql
```
Также, посмотрю, включена ли служба:
```
$ sudo systemctl is-enabled postgresql
```
И наконец, я могу увидеть статус службы PostgreSQL:
```
$ sudo systemctl status postgresql
```
После чего, убеждаюсь, что PostgreSQL-сервер готов принимать подключения от клиентов:
```
$ sudo pg_isready
```


## *Настройка клиентской аутентификации PostgreSQL*

СУБД PostgreSQL использует клиентскую аутентификацию для того, чтобы решать, какая учётная запись к какой базе данных и с какого хоста может подключаться. Это определяется настройками конфигурационного файла клиентской аутентификации. В Ubuntu таким файлом является файл pg_hba.conf. Он располагается в директории /etc/postgresql/16/main/.

Открою этот файл для редактирования, например, с помощью текстового редактора nano:
```
$ cd /etc/postgresql/12/main
$ sudo nano pg_hba.conf
```
PostgreSQL использует много типов методов клиентской аутентификации, таких как peer, ident, password или md5. Тип md5 является наиболее безопасным и рекомендуемым по причине того, что он требует от клиента использовать для аутентификации пароли с двойным md5-хешированием. Поэтому мне остаётся лишь убедиться, что в строках ниже указан именно метод md5

Если я произвел в конфигурационном файле какие-либо изменения, нужно сохранить их при закрытии файла. В nano для этого необходимо нажать Ctrl X, затем Y и Enter. После чего, перезапустите службу:
```
$ sudo systemctl restart postgresql
```
## *Установка pgAdmin4*

Пакет pgAdmin4 не доступен для установки из официальных репозиториев Ubuntu. Поэтому я буду устанавливать его из репозитория pgAdmin4 APT. Для этого сначала необходимо установить данный репозиторий.

Добавлю публичный ключ для репозитория и создам его конфигурационный файл. Для чего набиеру следующие команды:
```
$ curl https://www.pgadmin.org/static/packages_pgadmin_org.pub | sudo apt-key add
$ sudo sh -c 'echo "deb https://ftp.postgresql.org/pub/pgadmin/pgadmin4/apt/$(lsb_release -cs) pgadmin4 main" > /etc/apt/sources.list.d/pgadmin4.list && apt update'
```
Затем запущу установку pgAdmin4:
```
$ sudo apt install pgadmin4
```
Данной командой я установил набор необходимых пакетов включая веб-сервер Apache2. После завершения инсталляции запущу скрипт для установки веб-компонентов. Данный скрипт должен был установиться вместе с пакетом pgdmin4. Во время своей работы скрипт попросит вас ввести адрес электронной почты. В своем примере я будем использовать salakhovtural666@gmail.com. Также, скрипт потребует установить пароль, который необходимо ввести дважды. Эти E-mail и пароль я буду в дальнейшем использовать для подключения к веб-интерфейсу pgAdmin4.
```
$ sudo /usr/pgadmin4/bin/setup-web.sh
```
В процессе установки скрипт перезапустит службу Apache2 для того, чтобы вступили в силу произведённые изменения.

После того, как скрипт закончит свою работу, нужно будет добавить разрешение для Apache2 на доступ через брандмауэр. Чтобы сделать это, наберу:
```
$ sudo ufw allow 'Apache'
```
Запущу брандмауэр:
```
$ sudo ufw enable
```
Пойму, что служба Apache2 включена в список разрешённых на брандмауэре моего сервера:
```
$ sudo ufw status
```
## *Создание базы данных в PostgreSQL*

Чтобы создать новую базу данных, я должен получить доступ к программной оболочке PostgreSQL. Во-первых, подключюсь к системе с помощью учётной записи postgres:
```
$ sudo su - postgres
```
Подключившись, выполню команду psql:
```
$ psql
```
Если я вижу приглашение ко вводу команд postgres=#, значит я нахожусь в оболочке СУБД PostgreSQL. И значит, можно приступать к созданию базы данных. Первая команда добавит в PostgreSQL пользователя Salakhov :
```
CREATE USER Salakhov WITH PASSWORD '12341234';
```
Следующая команда создаст базу данных, которую мы назовём, например, Salakhov:
```
CREATE DATABASE Salakhov;
```
Теперь, назначю своему пользователю все права сразу на свою базу данных. В моем примере это будет выглядеть так:
```
GRANT ALL PRIVILEGES ON DATABASE Salakhov to Salakhov;
```
В данной лабораторной работе я научился устанавливать PostgreSQL и pgAdmin4 в Ubuntu, а так же установливать и управлять сервером
